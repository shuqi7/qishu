{"version":3,"sources":["../../../src/browser/components/Root.js"],"names":["DefaultPath","render","DefaultRouter","children","basepath","staticInfo","document","path","RouterHook","plugins","sync","ResolvedRouter","Root","props","process","env","REACT_STATIC_ENV","sharedData","sharedHashesByProp","template","routeInfoByPath","Object","keys","forEach","propKey","sharedDataByHash","currentPath","routeErrorByPath","templateErrorByPath","disableScroller","autoScrollToTop","autoScrollToHash","scrollToTopDuration","scrollToHashDuration","scrollToHashOffset","scrollerProps","Wrapper","React","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { Router as ReachRouter, ServerLocation } from '@reach/router'\n//\nimport {\n  routeInfoByPath,\n  sharedDataByHash,\n  registerTemplateForPath,\n  plugins,\n  getCurrentRoutePath,\n  routeErrorByPath,\n  templateErrorByPath,\n} from '../'\nimport { getBasePath, makePathAbsolute, makeHookReducer } from '../utils'\nimport ErrorBoundary from './ErrorBoundary'\nimport HashScroller from './HashScroller'\nimport { withStaticInfo } from './StaticInfo'\n\nconst DefaultPath = ({ render }) => render\n\nconst DefaultRouter = ({ children, basepath, staticInfo }) => {\n  children = (\n    <ReachRouter basepath={basepath}>\n      <DefaultPath default render={children} />\n    </ReachRouter>\n  )\n  return typeof document === 'undefined' ? (\n    <ServerLocation url={makePathAbsolute(staticInfo.path)}>\n      {children}\n    </ServerLocation>\n  ) : (\n    children\n  )\n}\n\nconst RouterHook = makeHookReducer(plugins, 'Router', { sync: true })\nconst ResolvedRouter = RouterHook(DefaultRouter)\n\nconst Root = withStaticInfo(\n  class Root extends React.Component {\n    static defaultProps = {\n      disableScroller: false, // TODO:v6 document this!\n      autoScrollToTop: true,\n      autoScrollToHash: true,\n      scrollToTopDuration: 0,\n      scrollToHashDuration: 800,\n      scrollToHashOffset: 0,\n    }\n    constructor(props) {\n      super()\n      const { staticInfo } = props\n      if (process.env.REACT_STATIC_ENV === 'production' && staticInfo) {\n        const { path, sharedData, sharedHashesByProp, template } = staticInfo\n\n        // Hydrate routeInfoByPath with the embedded routeInfo\n        routeInfoByPath[path] = staticInfo\n\n        // Hydrate sharedDataByHash with the embedded routeInfo\n        Object.keys(sharedHashesByProp).forEach(propKey => {\n          sharedDataByHash[sharedHashesByProp[propKey]] = sharedData[propKey]\n        })\n\n        // In SRR and production, synchronously register the template for the\n        // initial path\n        registerTemplateForPath(path, template)\n\n        // For a 404 route we will register the current route as invalid\n        if (path === '404') {\n          const currentPath = getCurrentRoutePath()\n          // As long as we didn't navigate to the 404.html page directly\n          if (currentPath !== '404') {\n            routeErrorByPath[currentPath] = true\n            templateErrorByPath[currentPath] = true\n          }\n        }\n      }\n    }\n    render() {\n      const {\n        children,\n        disableScroller,\n        autoScrollToTop,\n        autoScrollToHash,\n        scrollToTopDuration,\n        scrollToHashDuration,\n        scrollToHashOffset,\n        staticInfo,\n      } = this.props\n\n      const scrollerProps = {\n        autoScrollToTop,\n        autoScrollToHash,\n        scrollToTopDuration,\n        scrollToHashDuration,\n        scrollToHashOffset,\n      }\n\n      let Wrapper = ({ children }) => children\n\n      const basepath = getBasePath()\n\n      // Add the scroller if not disabled\n      if (!disableScroller) {\n        Wrapper = ({ children }) => (\n          <HashScroller {...scrollerProps}>{children}</HashScroller>\n        )\n      }\n\n      return (\n        <ErrorBoundary>\n          <Wrapper>\n            <ResolvedRouter basepath={basepath} staticInfo={staticInfo}>\n              {children}\n            </ResolvedRouter>\n          </Wrapper>\n        </ErrorBoundary>\n      )\n    }\n  }\n)\n\nexport default Root\n"],"file":"Root.js"}