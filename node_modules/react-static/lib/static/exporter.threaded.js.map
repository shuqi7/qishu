{"version":3,"sources":["../../src/static/exporter.threaded.js"],"names":["require","setIgnorePath","process","on","payload","oldConfig","config","routes","incremental","originalConfig","paths","DIST","Comp","glob","sync","path","resolve","ASSETS","default","DocumentTemplate","Document","DefaultDocument","tasks","i","route","push","connected","send","type","length","Number","outputFileRate","exit","console","error"],"mappings":";;;;AAIA;;AACA;;AAEA;;AACA;;AACA;;AACA;;;;;;;;;;;;AAVA;eAE0BA,OAAO,CAAC,oBAAD,C;IAAzBC,a,YAAAA,a;;AAURC,OAAO,CAACC,EAAR,CAAW,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAsB,kBAAMC,OAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAEFC,sBAAAA,SAFE,GAEiCD,OAFjC,CAEVE,MAFU,EAESC,MAFT,GAEiCH,OAFjC,CAESG,MAFT,EAEiBC,WAFjB,GAEiCJ,OAFjC,CAEiBI,WAFjB,EAGlB;;AAHkB;AAAA,6BAIG,wBAAUH,SAAS,CAACI,cAApB,CAJH;;AAAA;AAIZH,sBAAAA,MAJY;AAMlBL,sBAAAA,aAAa,CAACK,MAAM,CAACI,KAAP,CAAaC,IAAd,CAAb,CANkB,CAQlB;;AACMC,sBAAAA,IATY,GASLZ,OAAO,CAACa,cAAKC,IAAL,CACnBC,cAAKC,OAAL,CAAaV,MAAM,CAACI,KAAP,CAAaO,MAA1B,EAAkC,aAAlC,CADmB,EAEnB,CAFmB,CAAD,CAAP,CAEPC,OAXY,EAYlB;;AACMC,sBAAAA,gBAbY,GAaOb,MAAM,CAACc,QAAP,IAAmBC,+BAb1B;AAeZC,sBAAAA,KAfY,GAeJ,EAfI;;AAAA,6CAgBTC,CAhBS;AAiBhB,4BAAMC,KAAK,GAAGjB,MAAM,CAACgB,CAAD,CAApB;AACAD,wBAAAA,KAAK,CAACG,IAAN;AAAA;AAAA;AAAA;AAAA,kDAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCACH,4CACDrB,OADC;AAEJE,oCAAAA,MAAM,EAANA,MAFI;AAGJkB,oCAAAA,KAAK,EAALA,KAHI;AAIJZ,oCAAAA,IAAI,EAAJA,IAJI;AAKJO,oCAAAA,gBAAgB,EAAhBA,gBALI;AAMJX,oCAAAA,WAAW,EAAXA;AANI,qCADG;;AAAA;AAST,sCAAIN,OAAO,CAACwB,SAAZ,EAAuB;AACrBxB,oCAAAA,OAAO,CAACyB,IAAR,CAAa;AAAEC,sCAAAA,IAAI,EAAE;AAAR,qCAAb;AACD;;AAXQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAX;AAlBgB;;AAgBlB,2BAASL,CAAT,GAAa,CAAb,EAAgBA,CAAC,GAAGhB,MAAM,CAACsB,MAA3B,EAAmCN,CAAC,EAApC,EAAwC;AAAA,8BAA/BA,CAA+B;AAevC;;AA/BiB;AAAA,6BAgCZ,oBAAQD,KAAR,EAAeQ,MAAM,CAACxB,MAAM,CAACyB,cAAR,CAArB,CAhCY;;AAAA;AAiClB,0BAAI7B,OAAO,CAACwB,SAAZ,EAAuB;AACrBxB,wBAAAA,OAAO,CAACyB,IAAR,CAAa;AAAEC,0BAAAA,IAAI,EAAE;AAAR,yBAAb;AACD;;AACD1B,sBAAAA,OAAO,CAAC8B,IAAR;;AApCkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAsClBC,YAAAA,OAAO,CAACC,KAAR;;AACA,gBAAIhC,OAAO,CAACwB,SAAZ,EAAuB;AACrBxB,cAAAA,OAAO,CAACyB,IAAR,CAAa;AAAEC,gBAAAA,IAAI,EAAE,OAAR;AAAiBxB,gBAAAA,OAAO;AAAxB,eAAb;AACD;;AACDF,YAAAA,OAAO,CAAC8B,IAAR,CAAa,CAAb;;AA1CkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAtB;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* eslint-disable import/first, import/no-dynamic-require */\n\nconst { setIgnorePath } = require('../utils/binHelper')\n\nimport glob from 'glob'\nimport path from 'path'\n\nimport getConfig from './getConfig'\nimport { DefaultDocument } from './RootComponents'\nimport { poolAll } from '../utils'\nimport exportRoute from './exportRoute'\n\nprocess.on('message', async payload => {\n  try {\n    const { config: oldConfig, routes, incremental } = payload\n    // Get config again\n    const config = await getConfig(oldConfig.originalConfig)\n\n    setIgnorePath(config.paths.DIST)\n\n    // Use the node version of the app created with webpack\n    const Comp = require(glob.sync(\n      path.resolve(config.paths.ASSETS, 'static.*.js')\n    )[0]).default\n    // Retrieve the document template\n    const DocumentTemplate = config.Document || DefaultDocument\n\n    const tasks = []\n    for (let i = 0; i < routes.length; i++) {\n      const route = routes[i]\n      tasks.push(async () => {\n        await exportRoute({\n          ...payload,\n          config,\n          route,\n          Comp,\n          DocumentTemplate,\n          incremental,\n        })\n        if (process.connected) {\n          process.send({ type: 'tick' })\n        }\n      })\n    }\n    await poolAll(tasks, Number(config.outputFileRate))\n    if (process.connected) {\n      process.send({ type: 'done' })\n    }\n    process.exit()\n  } catch (err) {\n    console.error(err)\n    if (process.connected) {\n      process.send({ type: 'error', payload: err })\n    }\n    process.exit(1)\n  }\n})\n"],"file":"exporter.threaded.js"}